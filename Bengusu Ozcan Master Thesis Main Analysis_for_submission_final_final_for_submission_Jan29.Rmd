---
THIS FILE IS ANONYMIZED FOR THE PURPOSE OF SCIENTIFIC PEER REVIEW OF THE RELEVANT MANUSCRIPT

title: Should Paid Streaming Services Make Personalization Optional? An Experiment on User Preferences for Personalization.
date: "12/27/2022"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#Please install necessary packages as below if not installed yet
#install.packages("dplyr")
#install.packages("tidyverse")
#install.packages("ggplot2")
#install.packages("gt")
#install.packages("psych")
#install.packages("texreg")
#install.packages("stargazer")
#install.packages("broom")
#install.packages("doBy")
#install.packages("readr")
library(broom)
library(stargazer)
library(texreg)
library(dplyr)
library(tidyverse)
library(ggplot2)
library(gt)
library(doBy)
library(psych)
library (readr)
```

**Data Ingestion**

```{r}
#For the purpose of keeping the experiment data private, please download the data file shared below on your local computer. By running the code in this chunk, read them from the relevant path in your local machine by choosing that file manually.

#read Cleaned_Modified_Substituted_Personalization_Preferences_12-18-21-Qualtrics.csv as data 
data <- read.csv(file.choose())
```

```{r}
#separate data into control and treatment groups to be used in some of the analyses. 
data_control <- data %>% filter(group=='control')
data_treatment <- data %>% filter(group=='treatment')
```

```{r}

#Answers to questions about PSP usage is tokenized in this file using Microsoft Excel functionalities. Example action: The original answer "Netlix, Hulu, Amazon Prime" is tokenized in this file as "Netflix: 1, Hulu:1, Spotify:0..."

#For the purpose of keeping the experiment data private, please download the data files shared below on your local computer. By running the code in this chunk, read them from the relevant path in your local machine by choosing that file manually.

#read Modified_Platforms_Used_Personalization_Preferences_12-18-21-Qualtrics.csv from as platforms
platforms<-read_csv(file.choose())
```

**Demographics**

```{r}
#General Demographics
#Values in Table1

data %>% group_by(group) %>% summarise(max=max(Age),min=min(Age),avg=mean(Age),med=median(Age))
data %>% summarise(max=max(Age),min=min(Age),avg=mean(Age),med=median(Age))
table(recoded$Gender,recoded$group)
table(recoded$Education,recoded$group)
table(recoded$Income,recoded$group)
table(recoded$Political,recoded$group)
data %>% group_by(group, Using_Spotify) %>% summarise(n=n())
```

```{r}
#Table 2
data %>% filter(Platforms != '') %>% group_by(group, Personalization) %>% summarise(n=n())
```

```{r}
#Table 3
data %>% filter(Platforms != '') %>% filter(Personalization != 'Never') %>% group_by(group, Satisfaction) %>% summarise(n=n())
```


```{r}
#Figure 1 data manipulation to include "all others" option in the relevant survey question.

#Which PSPs Do the Participants Use in Real Life?

platforms2 <- platforms %>% group_by(Platforms) %>% filter(Platforms != "All of the above") %>% summarize(count=n()+1)
platforms2 %>% ggplot(aes(x=reorder(Platforms,count),y=count))+geom_bar(stat='identity',position='dodge')+labs(y = "Number of people")+
  theme_minimal()+scale_fill_grey()+
    geom_text( aes(label = count),colour = "black", size = 3, vjust = 0.3, hjust=-0.2, position = position_dodge(.8))+theme(axis.title.y=element_blank(),panel.grid.major = element_blank(), panel.grid.minor = element_blank())+coord_flip()
```

**Summary statistics for main dependent variables**

```{r}
data %>% group_by(group) %>% summarize(count=n(),avg=mean(fee), sd=sd(fee))
data %>% group_by(group) %>% summarize(count=n(),avg=mean(Personalization_fee_difference), sd=sd(Personalization_fee_difference))

#Y1
describe(data$fee)
describe(data_control$fee)
describe(data_treatment$fee)

#Y2
describe(data$Personalization_fee_difference)
describe(data_control$Personalization_fee_difference)
describe(data_treatment$Personalization_fee_difference)
```

```{r}
#Variance of main dependent variables

#Y1
var(data$fee)
var(data_control$fee)
var(data_treatment$fee)

#Y2
var(data$Personalization_fee_difference)
var(data_control$Personalization_fee_difference)
var(data_treatment$Personalization_fee_difference)
```


**Main Hypotheses Tests**

1) Hypothesis A

Normality test 

```{r}
#Y1 is not normally distributed
shapiro.test(data$fee)
```

F-test for equal variances

```{r}
#there is no significant difference between the variances of Y1 between the two sets of data
ftest1 <- var.test(fee ~ group, data = data)
ftest1
```

2 sample t-test
```{r}
#No statistically significant difference between control and treatment groups for Y1
HA_ttest <-t.test(fee ~ group, data = data, var.equal=TRUE)
HA_ttest
```

2) Hypothesis B

Normality test on Y2
```{r}
#Y2 is not normally distributed
shapiro.test(data$Personalization_fee_difference)
```

F test on Y2

```{r}
#there is no significant difference between the variances of the two sets of data
ftest2 <- var.test(Personalization_fee_difference ~ group, data = data)
ftest2
```

2 Sample t-test on Y2

```{r}
HB_ttest2 <-t.test(Personalization_fee_difference  ~ group, data = data, var.equal=T)
HB_ttest2
```

Welch sample t-test on Y2

```{r}
HB_ttest3 <-t.test(Personalization_fee_difference   ~ group, data = data)
HB_ttest3
```


```{r}
#Results for statistics explained in the following part of the manuscript: When looked in detail, out of 264 participants in the treatment group, 177 (67\%) thought that the fee with and without personalization should be the same, 73 (28\%) thought the personalization should cost more and 13 (5\%) thought opting out should cost more while out of 263 participants in the control group, 185 (70\%) thought that the fee with and without personalization should be the same, 58 (22\%) thought the personalization should cost more and 21 (8\%) thought opting out should cost more. This indicates that regardless of the explicit information on how their OPD is being leveraged, respondents perceive personalization as an extra service that should be paid for rather than paying for privacy of their data.

data %>% group_by(group, equal_fee) %>% summarise(count=n())
```


**Reconstructing Control and Treatment Groups Based on Understanding Check**

Do control and treatment people have different opinions on whether their data is used for others or not?

```{r}
#Results for statistics explained in the following part of the manuscript: The question read “whether your data is used for recommending songs to others” to which the treatment group was expected to answer “yes” and the control group was expected to answer “no”. 99.2\% of the treatment group answered “yes” as expected; however, 32\% of the control group responded “yes” as well. This indicates that they may have had prior knowledge on PSPs’ use of their OPD and behaved similarly to the treatment group. Therefore, the groups were reconstructed as “yes” responders being the new treatment group (n=346) and “no” responders being the new control group (n=181).

data %>% group_by(group, understand_other) %>% summarise(count=n())
```

```{r}
# Copying the data file in order to reconstruct the control and treatment groups based on the understanding check
reconst <- data
```

```{r}
#reconstructing control and treatment groups based on answers to understanding checks
reconst <- reconst %>% 
  mutate("reconst_groups" = if_else((understand_you == "Yes" & understand_other =="Yes"), "reconst_treatment",if_else(understand_you=="Yes" & understand_other=="No", "reconst_control","ignore"))) %>% filter(reconst_groups!="ignore")
```

```{r}
#summary of new control and treatment groups
reconst %>% group_by(reconst_groups) %>% summarise(count=n(),fee=mean(fee),sd_fee=sd(fee),diff_fee=mean(Personalization_fee_difference),sd_diff=sd(Personalization_fee_difference),pers_fee=mean(Fee_personalization),sd_pers=sd(Fee_personalization),without_fee=mean(Fee_without_personalization),sd_without=sd(Fee_without_personalization))
```

1) Testing HA with reconstructed groups

F-test on the reconstructed group

```{r}
ftest5 <- var.test(fee ~ reconst_groups, data = reconst)
ftest5
```

2 sample t-test

```{r}
#no statistically significant difference
HA_reconst_ttest <-t.test(fee ~ reconst_groups, data = reconst, var.equal=T)
HA_reconst_ttest
```


2) Testing HB with reconstructed groups

F test on D2
```{r}
ftest5 <- var.test(Personalization_fee_difference ~ reconst_groups, data = reconst)
ftest5
```


Welch on D2

```{r}
#statistically significant difference is found between treatment and control
HB_reconst_ttest <-t.test(Personalization_fee_difference ~ reconst_groups, data = reconst)
HB_reconst_ttest
```

2-sample t-test on D2

```{r}
#statistically significant difference is found between treatment and control
HB_reconst_2sample_ttest <-t.test(Personalization_fee_difference  ~ reconst_groups, data = reconst, var.equal=T)
HB_reconst_2sample_ttest 
```

```{r}
#Table 4
reconst %>% group_by(reconst_groups) %>% summarize("Average fee with personalization"=mean(Fee_personalization), "Average fee without personalization"=mean(Fee_without_personalization), "Difference"=mean(Personalization_fee_difference))
data %>% group_by(group) %>% summarize("Average fee with personalization"=mean(Fee_personalization), "Average fee without personalization"=mean(Fee_without_personalization), "Difference"=mean(Personalization_fee_difference))
```

**Further Analysis: Linear regression on the dependent variables**

Linear Regression Models - Below 10 models are the initial models before feature selection in order to simplify the models based on statistical significance

Initial 10 linear regression models, not simplified, include all independent variables

```{r}
#due to "prefer not to say" answers creating NAs in Income_numeric, we tested Income_numeric and income as factor and found higher R-squared for income as factor. Hence we will introduce income as factorial categorical variables in rest of the models.
lm1<- lm(fee ~ as.factor(group)+Age+as.factor(Gender)+Education_numeric+as.factor(Income)+Using_PSPs+Using_Spotify+Personalization_satisfaction + as.factor(Political), data=data)
summary(lm1)
```

```{r}
lm2<- lm(Fee_personalization ~ as.factor(group)+Age+as.factor(Gender)+Education_numeric+as.factor(Income)+Using_PSPs+Using_Spotify+ +Personalization_satisfaction + as.factor(Political), data=data, na.rm=T)
summary(lm2)
```

```{r}
lm3<- lm(Fee_without_personalization ~ as.factor(group)+Age+as.factor(Gender)+Education_numeric+as.factor(Income)+Using_PSPs+Using_Spotify+ +Personalization_satisfaction + as.factor(Political), data=data, na.rm=T)
summary(lm3)
```

```{r}
lm4<- lm(Personalization_fee_difference ~ as.factor(group)+Age+as.factor(Gender)+Education_numeric+as.factor(Income)+Using_PSPs+Using_Spotify+ +Personalization_satisfaction + as.factor(Political), data=data, na.rm=T)
summary(lm4)
```

```{r}
lm5 <-lm(benefit_1 ~ as.factor(group)+Age+as.factor(Gender)+Education_numeric+as.factor(Income)+Using_PSPs+Using_Spotify+ +Personalization_satisfaction + as.factor(Political), data=data, na.rm=T)
summary(lm5)
```

```{r}
lm6 <-lm(benefit_4 ~ as.factor(group)+Age+as.factor(Gender)+Education_numeric+as.factor(Income)+Using_PSPs+Using_Spotify+ +Personalization_satisfaction+as.factor(Political), data=data, na.rm=T)
summary(lm6)
```

```{r}
lm7<-lm(benefit_5 ~ as.factor(group)+Age+as.factor(Gender)+Education_numeric+as.factor(Income)+Using_PSPs+Using_Spotify+ +Personalization_satisfaction +as.factor(Political), data=data, na.rm=T)
summary(lm7)
```

```{r}
lm8 <-lm(preferences_1 ~ as.factor(group)+Age+as.factor(Gender)+Education_numeric+as.factor(Income)+Using_PSPs+Using_Spotify+ +Personalization_satisfaction + as.factor(Political), data=data, na.rm=T)
summary(lm8)
```

```{r}
lm9 <-lm(preferences_4 ~ as.factor(group)+Age+as.factor(Gender)+Education_numeric+as.factor(Income)+Using_PSPs+Using_Spotify+ +Personalization_satisfaction + as.factor(Political), data=data, na.rm=T)
summary(lm9)
```

```{r}
lm10 <-lm(preferences_5 ~ as.factor(group)+Age+as.factor(Gender)+Education_numeric+as.factor(Income)+Using_PSPs+Using_Spotify+ +Personalization_satisfaction + as.factor(Political), data=data, na.rm=T)
summary(lm10)
```

**Model Selection & Simplification**

Model selection: Chose models that are statistically significant (p-value < 0.05) and has adjusted R-squared > 0.05 (explained in the manuscript)

Model simplification -> Reduced the independent variables to the significant variables only, applied ANOVA between the original and simplified models, kept the simplified model if ANOVA doesn't find a statistically significant difference between the two models 

Following the order in the paper:

```{r}
#Model1
lm10_simp <-lm(preferences_5 ~ Age+as.factor(Gender)+Personalization_satisfaction, data=data, na.rm=T)
summary(lm10_simp)
```

```{r}
#Model2
lm5_simp <-lm(benefit_1 ~ as.factor(Gender)+Personalization_satisfaction + as.factor(Political), data=data, na.rm=T)
summary(lm5_simp)
```

```{r}
#Model3
lm6_simp <-lm(benefit_4 ~ as.factor(group)+as.factor(Gender)+Personalization_satisfaction, data=data, na.rm=T)
summary(lm6_simp)
```

```{r}
#Model4
#As explained in the manuscript, this model was chosen despite low adjusted R-squared (5%) due to its connection to Model2 and Model3
lm7_simp<-lm(benefit_5 ~ as.factor(group)+Age+as.factor(Gender), data=data, na.rm=T)
summary(lm7_simp)
```

ANOVA analyses between the original and the simplified models

```{r}
#Anova for Model1
anova(lm10_simp, lm10)
```

```{r}
#Anova for Model2
anova(lm5_simp, lm5)
```

```{r}
#Anova for Model3
anova(lm6_simp, lm6)
```

```{r}
#Anova for Model4
anova (lm7_simp, lm7)
```

**Descriptive Statistics for Further Analysis Section**

```{r}
describe(data$benefit_1)
data %>% group_by(group) %>% summarise('n'=n(),'mean'=mean(benefit_1), 'sd'=sd(benefit_1))
```

```{r}
describe(data$Personalization_satisfaction)
```

```{r}
describe(data$preferences_5)
```

```{r}
describe(data$Age)
```

```{r}
describe(data$benefit_4)
```

```{r}
describe(data$benefit_5)
```

**Latex Conversions**

Latex for all the models mentioned in the article

```{r}
stargazer(lm10_simp, lm5_simp, lm6_simp, lm7_simp, title="From Left to Right: Model1, Model2, Model3, Model4",
align=TRUE, dep.var.labels=c("preferences_5","benefit_1", "benefit_4","benefit_5"),
omit.stat=c("LL","ser","f"), no.space=TRUE)
```
